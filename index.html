<!DOCTYPE html>

<html lang="ar" dir="rtl">



<head>

ย ย <meta charset="UTF-8">

ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">

ย ย <title>ูุธุงู ุทูุจ ุงููุนุฌูุงุช</title>

ย ย <script src="https://cdn.tailwindcss.com"></script>

ย ย <link rel="preconnect" href="https://fonts.googleapis.com">

ย ย <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

ย ย <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

ย ย <style>

ย ย ย ย body {

ย ย ย ย ย ย font-family: 'Cairo', sans-serif;

ย ย ย ย ย ย background-color: #f7fafc;

ย ย ย ย }

ย ย ย ย .card {

ย ย ย ย ย ย transition: transform 0.2s, box-shadow 0.2s;

ย ย ย ย }

ย ย ย ย .card:hover {

ย ย ย ย ย ย transform: translateY(-5px);

ย ย ย ย ย ย box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

ย ย ย ย }

ย ย ย ย .toast {

ย ย ย ย ย ย visibility: hidden;

ย ย ย ย ย ย opacity: 0;

ย ย ย ย ย ย transition: opacity 0.5s, visibility 0.5s;

ย ย ย ย }

ย ย ย ย .toast.show {

ย ย ย ย ย ย visibility: visible;

ย ย ย ย ย ย opacity: 1;

ย ย ย ย }

ย ย </style>

</head>



<body class="bg-gray-100 text-gray-800">



ย ย <!-- Main Container -->

ย ย <div id="app-container" class="container mx-auto p-4 md:p-8 max-w-7xl">



ย ย ย ย <!-- Header -->

ย ย ย ย <header class="text-center mb-8">

ย ย ย ย ย ย <h1 class="text-3xl md:text-5xl font-bold text-teal-600">ูุธุงู ุทูุจุงุช ุงููุนุฌูุงุช</h1>

ย ย ย ย ย ย <p class="text-gray-500 mt-2">ุงุฎุชุฑ ุทูุจู ุจุณูููุฉ ูุฏูุฉ</p>

ย ย ย ย </header>



ย ย ย ย <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">



ย ย ย ย ย ย <!-- Ordering Section (Right) -->

ย ย ย ย ย ย <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">

ย ย ย ย ย ย ย ย <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-teal-700">1. ูู ุจุฅูุดุงุก ุทูุจ ุฌุฏูุฏ</h2>

ย ย ย ย ย ย ย ยย

ย ย ย ย ย ย ย ย <!-- Employee Selection -->

ย ย ย ย ย ย ย ย <div class="mb-6">

ย ย ย ย ย ย ย ย ย ย <label for="employee-select" class="block text-lg font-medium text-gray-700 mb-2">ุงุฎุชุฑ ุงุณู ุงูููุธู:</label>

ย ย ย ย ย ย ย ย ย ย <div class="flex flex-col sm:flex-row gap-2">

ย ย ย ย ย ย ย ย ย ย ย ย <select id="employee-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></select>

ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย </div>



ย ย ย ย ย ย ย ย <!-- Menu Items -->

ย ย ย ย ย ย ย ย <div class="mb-6 relative">

ย ย ย ย ย ย ย ย ย ย <h3 class="text-xl font-semibold mb-4 text-gray-700">ูุงุฆูุฉ ุงููุนุฌูุงุช:</h3>

ย ย ย ย ย ย ย ย ย ย <div id="menu-overlay" class="absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10 rounded-lg">

ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-lg font-bold text-teal-700 p-4 text-center">ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุงุณู ุงูููุธู ุฃููุงู ูุชูุนูู ุงููุงุฆูุฉ</p>

ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย <div id="menu-items" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4"></div>

ย ย ย ย ย ย ย ย </div>



ย ย ย ย ย ย ย ย <!-- Current Order Summary -->

ย ย ย ย ย ย ย ย <div class="bg-gray-50 p-4 rounded-lg">

ย ย ย ย ย ย ย ย ย ย <h3 class="text-xl font-semibold mb-3">ููุฎุต ุงูุทูุจ ุงูุญุงูู:</h3>

ย ย ย ย ย ย ย ย ย ย <div id="current-order-summary"><p class="text-gray-500">ูู ูุชู ุงุฎุชูุงุฑ ุฃู ุตูู ุจุนุฏ.</p></div>

ย ย ย ย ย ย ย ย ย ย <div class="mt-4 text-2xl font-bold text-right">

ย ย ย ย ย ย ย ย ย ย ย ย ุงูุฅุฌูุงูู: <span id="current-total" class="text-teal-600">0</span> ู.ุณ

ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ยย

ย ย ย ย ย ย ย ย <!-- Action Button -->

ย ย ย ย ย ย ย ย <div class="mt-6 text-center">

ย ย ย ย ย ย ย ย ย ย <button id="submit-order-btn" class="w-full md:w-auto bg-teal-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed">

ย ย ย ย ย ย ย ย ย ย ย ย ุฅุถุงูุฉ ุงูุทูุจ

ย ย ย ย ย ย ย ย ย ย </button>

ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย </div>



ย ย ย ย ย ย <!-- Orders and Totals Section (Left) -->

ย ย ย ย ย ย <div class="lg:col-span-1 space-y-8">

ย ย ย ย ย ย ย ย <div class="bg-white p-6 rounded-xl shadow-lg">

ย ย ย ย ย ย ย ย ย ย <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-teal-700">2. ุฌููุน ุงูุทูุจุงุช</h2>

ย ย ย ย ย ย ย ย ย ย <div id="orders-list" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2"></div>

ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="bg-white p-6 rounded-xl shadow-lg">

ย ย ย ย ย ย ย ย ย ย <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-teal-700">3. ููุฎุต ุงูุฃุตูุงู</h2>

ย ย ย ย ย ย ย ย ย ย <div id="items-summary-list" class="space-y-2 max-h-[40vh] overflow-y-auto pr-2"></div>

ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="bg-white p-6 rounded-xl shadow-lg text-center">

ย ย ย ย ย ย ย ย ย ย <h2 class="text-2xl font-bold mb-3 text-teal-700">ุงููุฌููุน ุงูููู</h2>

ย ย ย ย ย ย ย ย ย ย <div id="grand-total-details" class="text-lg space-y-1 border-b pb-3 mb-3"></div>

ย ย ย ย ย ย ย ย ย ย <div id="grand-total" class="text-4xl font-extrabold text-teal-600">0 ู.ุณ</div>

ย ย ย ย ย ย ย ย ย ย <button id="clear-all-btn" class="mt-4 bg-red-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-700">ูุณุญ ุฌููุน ุงูุทูุจุงุช</button>

ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย </div>

ย ย ย ย </div>

ย ย </div>



ย ย <!-- Confirmation Modal & Toast -->

ย ย <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"></div>

ย ย <div id="toast-notification" class="toast fixed bottom-5 left-5 bg-green-500 text-white py-3 px-6 rounded-lg shadow-lg"></div>

ย ยย

ย ย <!-- Firebase and App Logic -->

ย ย <script type="module">

ย ย ย ย import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

ย ย ย ย import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

ย ย ย ย import { getFirestore, collection, doc, setDoc, onSnapshot, deleteDoc, writeBatch, query, getDocs, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";



ย ย ย ย const firebaseConfig = {

ย ย ย ย ย ย apiKey: "AIzaSyBvUPrmVFD2kUDYUjx99yxklkWcd1RjcuM",

ย ย ย ย ย ย authDomain: "my-pastry-app.firebaseapp.com",

ย ย ย ย ย ย projectId: "my-pastry-app",

ย ย ย ย ย ย storageBucket: "my-pastry-app.firebasestorage.app",

ย ย ย ย ย ย messagingSenderId: "905005872621",

ย ย ย ย ย ย appId: "1:905005872621:web:8ae8407c6cc1d71fef23e4"

ย ย ย ย };



ย ย ย ย const DELIVERY_COST = 5000;

ย ย ย ย const menuData = [

ย ย ย ย ย ย { id: 'zaytoon', name: 'ุฒูุชูู', price: 2500 }, { id: 'murtadella_qashqawan', name: 'ูุฑุชุฏููุง ูุดููุงู', price: 5000 }, { id: 'jibneh', name: 'ุฌุจูุฉ', price: 1500 }, { id: 'mhammara', name: 'ูุญูุฑุฉ', price: 1500 }, { id: 'mhammara_qashqawan', name: 'ูุญูุฑุฉ ูุดููุงู', price: 3500 }, { id: 'murtadella', name: 'ูุฑุชุฏููุง', price: 3500 }, { id: 'kiri', name: 'ููุฑู', price: 2500 }, { id: 'toshka', name: 'ุชูุดูุง', price: 6000 }, { id: 'sujuk', name: 'ุณุฌู', price: 4000 }, { id: 'qashqawan', name: 'ูุดููุงู', price: 3000 }, { id: 'zaatar_qashqawan', name: 'ุฒุนุชุฑ ูุดููุงู', price: 5000 }, { id: 'shish', name: 'ุดูุด', price: 7000 }, { id: 'sabanekh', name: 'ุณุจุงูุฎ', price: 1500 }, { id: 'kebab', name: 'ูุจุงุจ', price: 4000 }, { id: 'pizza', name: 'ุจูุชุฒุง', price: 3500 }, { id: 'zaatar', name: 'ุฒุนุชุฑ', price: 1500 },

ย ย ย ย ];

ย ย ย ย const employeeNames = [

ย ย ย ย ย ย 'ุฃุจ ูุนุชุฒ', 'ูุณุงู', 'ุฑููู', 'ุญูุง', 'ุนูุงุฏ', 'ุฅููุงู', 'ูุงูุฉ', 'ุนูุงุฏ (ูุฑุฏ)', 'ุจุดุฑู', 'ุงูุฑู', 'ุญูุฒุฉ', 'ุงุจุงุงุงุงุง ุญูุฒุฉุฉ', 'ููู', 'ุจุดุฑ', 'ูุฑูู', 'ููุงู', 'ูุนุงุฐ', 'ุนูุง', 'ุฃุจู ูุงุตุฑ', 'ูุงูุฑ', 'ุงูุงุก', 'ุฎุงูุฏ', 'ุจูุฏูุฑู', 'ุนูุงุก', 'ุฑุบุฏ', 'ุงุจู ุนูู'

ย ย ย ย ];



ย ย ย ย let currentOrder = {};

ย ย ย ย let db, auth, ordersCollectionRef, isAuthReady = false;



ย ย ย ย const employeeSelect = document.getElementById('employee-select');

ย ย ย ย const menuItemsContainer = document.getElementById('menu-items');

ย ย ย ย const menuOverlay = document.getElementById('menu-overlay');

ย ย ย ย const currentOrderSummary = document.getElementById('current-order-summary');

ย ย ย ย const currentTotalEl = document.getElementById('current-total');

ย ย ย ย const submitOrderBtn = document.getElementById('submit-order-btn');

ย ย ย ย const ordersList = document.getElementById('orders-list');

ย ย ย ย const itemsSummaryList = document.getElementById('items-summary-list');

ย ย ย ย const grandTotalEl = document.getElementById('grand-total');

ย ย ย ย const grandTotalDetailsEl = document.getElementById('grand-total-details');

ย ย ย ย const clearAllBtn = document.getElementById('clear-all-btn');

ย ย ย ย const confirmationModal = document.getElementById('confirmation-modal');

ย ย ย ย const toastNotification = document.getElementById('toast-notification');



ย ย ย ย function toggleMenuState() {

ย ย ย ย ย ย if (employeeSelect.value) {

ย ย ย ย ย ย ย ย menuOverlay.classList.add('hidden');

ย ย ย ย ย ย } else {

ย ย ย ย ย ย ย ย menuOverlay.classList.remove('hidden');

ย ย ย ย ย ย }

ย ย ย ย }



ย ย ย ย async function setupFirebase() {

ย ย ย ย ย ย try {

ย ย ย ย ย ย ย ย const app = initializeApp(firebaseConfig);

ย ย ย ย ย ย ย ย db = getFirestore(app);

ย ย ย ย ย ย ย ย auth = getAuth(app);

ย ย ย ย ย ย ย ย const appId = firebaseConfig.projectId || 'default-pastry-app';

ย ย ย ย ย ย ย ย ordersCollectionRef = collection(db, `artifacts/${appId}/public/data/pastry-orders`);



ย ย ย ย ย ย ย ย onAuthStateChanged(auth, async (user) => {

ย ย ย ย ย ย ย ย ย ย if (user) {

ย ย ย ย ย ย ย ย ย ย ย ย isAuthReady = true;

ย ย ย ย ย ย ย ย ย ย ย ย listenForOrders();

ย ย ย ย ย ย ย ย ย ย } else {

ย ย ย ย ย ย ย ย ย ย ย ย isAuthReady = false;

ย ย ย ย ย ย ย ย ย ย ย ย await signInAnonymously(auth).catch(err => console.error("Anonymous sign-in failed:", err));

ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย } catch (error) {

ย ย ย ย ย ย ย ย console.error("Firebase initialization failed:", error);

ย ย ย ย ย ย ย ย alert("ูุดู ุงูุงุชุตุงู ุจู Firebase.");

ย ย ย ย ย ย }

ย ย ย ย }

ย ย ย ยย

ย ย ย ย function showToast(message) {

ย ย ย ย ย ย toastNotification.textContent = message;

ย ย ย ย ย ย toastNotification.classList.add('show');

ย ย ย ย ย ย setTimeout(() => {

ย ย ย ย ย ย ย ย toastNotification.classList.remove('show');

ย ย ย ย ย ย }, 3000);

ย ย ย ย }



ย ย ย ย function renderAllOrders(orders, deliveryShare) {

ย ย ย ย ย ย ordersList.innerHTML = orders.length === 0 ? '<p class="text-gray-500 text-center py-4">ูุง ุชูุฌุฏ ุทูุจุงุช ูุณุฌูุฉ ุญุงููุงู.</p>' : '';

ย ย ย ย ย ย orders.forEach(order => {

ย ย ย ย ย ย ย ย const orderTotalWithDelivery = order.total + deliveryShare;

ย ย ย ย ย ย ย ย const isPaid = order.isPaid || false;

ย ย ย ย ย ย ย ย const orderCard = document.createElement('div');

ย ย ย ย ย ย ย ย orderCard.className = `p-4 rounded-lg border transition-colors ${isPaid ? 'bg-green-50' : 'bg-gray-50'}`;

ย ย ย ย ย ย ย ยย

ย ย ย ย ย ย ย ย let itemsHtml = '<ul class="text-sm space-y-1 mt-2">';

ย ย ย ย ย ย ย ย order.items.forEach(item => itemsHtml += `<li class="flex justify-between"><span>${item.name} <span class="text-gray-500">(x${item.quantity})</span></span> <span>${(item.price * item.quantity).toLocaleString()} ู.ุณ</span></li>`);

ย ย ย ย ย ย ย ย itemsHtml += '</ul>';



ย ย ย ย ย ย ย ย orderCard.innerHTML = `

ย ย ย ย ย ย ย ย ย ย <div class="flex justify-between items-start">

ย ย ย ย ย ย ย ย ย ย ย ย <h4 class="font-bold text-lg ${isPaid ? 'text-green-800' : 'text-teal-800'}">${order.employeeName}</h4>

ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex gap-2">

ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button data-id="${order.id}" class="edit-order-btn text-blue-500 hover:text-blue-700 text-xs">โ๏ธ</button>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button data-id="${order.id}" class="delete-order-btn text-red-500 hover:text-red-700 text-xs">๐๏ธ</button>

ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ${itemsHtml}

ย ย ย ย ย ย ย ย ย ย <div class="mt-2 pt-2 border-t">

ย ย ย ย ย ย ย ย ย ย ย ย <p class="font-semibold text-sm text-gray-600 flex justify-between"><span>ุฅุฌูุงูู ุงูุทูุจ:</span> <span>${order.total.toLocaleString()} ู.ุณ</span></p>

ย ย ย ย ย ย ย ย ย ย ย ย <p class="font-semibold text-sm text-gray-600 flex justify-between"><span>ุญุตุฉ ุงูุชูุตูู:</span> <span>${deliveryShare.toLocaleString()} ู.ุณ</span></p>

ย ย ย ย ย ย ย ย ย ย ย ย <p class="font-bold text-md ${isPaid ? 'text-green-600' : 'text-teal-600'} mt-1 flex justify-between"><span>ุงูุฅุฌูุงูู ุงูููุงุฆู:</span> <span>${orderTotalWithDelivery.toLocaleString()} ู.ุณ</span></p>

ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย <button data-id="${order.id}" data-paid="${isPaid}" class="payment-status-btn w-full mt-3 p-2 text-sm font-bold rounded-lg ${isPaid ? 'bg-green-200 text-green-800' : 'bg-yellow-200 text-yellow-800'}">

ย ย ย ย ย ย ย ย ย ย ย ย ${isPaid ? 'โ ูุฏููุน' : '๐ต ูู ูุฏูุน'}

ย ย ย ย ย ย ย ย ย ย </button>

ย ย ย ย ย ย ย ย `;

ย ย ย ย ย ย ย ย ordersList.appendChild(orderCard);

ย ย ย ย ย ย });

ย ย ย ย }

ย ย ย ยย

ย ย ย ย function updateCurrentOrderDisplay() {

ย ย ย ย ย ย let total = 0;

ย ย ย ย ย ย currentOrderSummary.innerHTML = '';

ย ย ย ย ย ย const items = Object.keys(currentOrder);



ย ย ย ย ย ย if (items.length === 0) {

ย ย ย ย ย ย ย ย currentOrderSummary.innerHTML = '<p class="text-gray-500">ูู ูุชู ุงุฎุชูุงุฑ ุฃู ุตูู ุจุนุฏ.</p>';

ย ย ย ย ย ย ย ย currentTotalEl.textContent = '0';

ย ย ย ย ย ย } else {

ย ย ย ย ย ย ย ย const list = document.createElement('ul');

ย ย ย ย ย ย ย ย list.className = 'space-y-1';

ย ย ย ย ย ย ย ย items.forEach(itemId => {

ย ย ย ย ย ย ย ย ย ย const quantity = currentOrder[itemId];

ย ย ย ย ย ย ย ย ย ย if (quantity > 0) {

ย ย ย ย ย ย ย ย ย ย ย ย const itemData = menuData.find(m => m.id === itemId);

ย ย ย ย ย ย ย ย ย ย ย ย total += itemData.price * quantity;

ย ย ย ย ย ย ย ย ย ย ย ย const listItem = document.createElement('li');

ย ย ย ย ย ย ย ย ย ย ย ย listItem.className = 'flex justify-between items-center';

ย ย ย ย ย ย ย ย ย ย ย ย listItem.innerHTML = `<span>${itemData.name} <span class="text-gray-500 text-sm">(x${quantity})</span></span><span class="font-semibold">${(itemData.price * quantity).toLocaleString()} ู.ุณ</span>`;

ย ย ย ย ย ย ย ย ย ย ย ย list.appendChild(listItem);

ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย currentOrderSummary.appendChild(list);

ย ย ย ย ย ย ย ย currentTotalEl.textContent = total.toLocaleString();

ย ย ย ย ย ย }

ย ย ย ย ย ยย

ย ย ย ย ย ย menuData.forEach(item => {

ย ย ย ย ย ย ย ย const qtyEl = document.getElementById(`qty-${item.id}`);

ย ย ย ย ย ย ย ย if(qtyEl) {

ย ย ย ย ย ย ย ย ย ย qtyEl.textContent = currentOrder[item.id] || 0;

ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย });

ย ย ย ย }

ย ย ย ยย

ย ย ย ย function resetCurrentOrderForm() {

ย ย ย ย ย ย currentOrder = {};

ย ย ย ย ย ย updateCurrentOrderDisplay();

ย ย ย ย ย ย employeeSelect.value = '';

ย ย ย ย ย ย submitOrderBtn.textContent = 'ุฅุถุงูุฉ ุงูุทูุจ';

ย ย ย ย ย ย toggleMenuState();

ย ย ย ย }

ย ย ย ยย

ย ย ย ย async function handleSubmitOrder() {

ย ย ย ย ย ย const employeeName = employeeSelect.value;

ย ย ย ย ย ย if (!employeeName) {

ย ย ย ย ย ย ย ย alert("ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุงุณู ุงูููุธู ุฃููุงู.");

ย ย ย ย ย ย ย ย return;

ย ย ย ย ย ย }

ย ย ย ย ย ย const itemsInOrder = Object.entries(currentOrder).filter(([_, qty]) => qty > 0).map(([id, quantity]) => ({ ...menuData.find(m => m.id === id), quantity }));

ย ย ย ย ย ย if (itemsInOrder.length === 0) {

ย ย ย ย ย ย ย ย alert("ูุง ููููู ุฅุถุงูุฉ ุทูุจ ูุงุฑุบ.");

ย ย ย ย ย ย ย ย return;

ย ย ย ย ย ย }

ย ย ย ย ย ย const total = itemsInOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0);

ย ย ย ย ย ยย

ย ย ย ย ย ย const docRef = doc(ordersCollectionRef, employeeName);

ย ย ย ย ย ย const docSnap = await getDoc(docRef);

ย ย ย ย ย ย const isUpdating = docSnap.exists();

ย ย ย ย ย ย const currentPaidStatus = isUpdating ? docSnap.data().isPaid : false;



ย ย ย ย ย ย const newOrder = { employeeName, items: itemsInOrder, total, isPaid: currentPaidStatus, createdAt: new Date().toISOString() };

ย ย ย ย ย ยย

ย ย ย ย ย ย submitOrderBtn.disabled = true;

ย ย ย ย ย ย try {

ย ย ย ย ย ย ย ย await setDoc(docRef, newOrder, { merge: true });

ย ย ย ย ย ย ย ย showToast(`ุชู ${isUpdating ? 'ุชุญุฏูุซ' : 'ุฅุถุงูุฉ'} ุทูุจ ${employeeName}`);

ย ย ย ย ย ย ย ย resetCurrentOrderForm();

ย ย ย ย ย ย } catch (error) {

ย ย ย ย ย ย ย ย console.error("Error adding/updating document: ", error);

ย ย ย ย ย ย } finally {

ย ย ย ย ย ย ย ย submitOrderBtn.disabled = false;

ย ย ย ย ย ย }

ย ย ย ย }



ย ย ย ย async function handleEditOrder(event) {

ย ย ย ย ย ย const button = event.target.closest('.edit-order-btn');

ย ย ย ย ย ย if (!button) return;

ย ย ย ย ย ย const docId = button.dataset.id;

ย ย ย ย ย ย const orderDoc = await getDoc(doc(ordersCollectionRef, docId));

ย ย ย ย ย ย if (orderDoc.exists()) {

ย ย ย ย ย ย ย ย const orderData = orderDoc.data();

ย ย ย ย ย ย ย ย employeeSelect.value = orderData.employeeName;

ย ย ย ย ย ย ย ย toggleMenuState();

ย ย ย ย ย ย ย ย currentOrder = {};

ย ย ย ย ย ย ย ย orderData.items.forEach(item => {

ย ย ย ย ย ย ย ย ย ย currentOrder[item.id] = item.quantity;

ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย updateCurrentOrderDisplay();

ย ย ย ย ย ย ย ย submitOrderBtn.textContent = "ุชุญุฏูุซ ุงูุทูุจ";

ย ย ย ย ย ย ย ย window.scrollTo({ top: 0, behavior: 'smooth' });

ย ย ย ย ย ย }

ย ย ย ย }



ย ย ย ย async function handlePaymentStatus(event) {

ย ย ย ย ย ย const button = event.target.closest('.payment-status-btn');

ย ย ย ย ย ย if (!button) return;

ย ย ย ย ย ย const docId = button.dataset.id;

ย ย ย ย ย ย const currentStatus = button.dataset.paid === 'true';

ย ย ย ย ย ย await updateDoc(doc(ordersCollectionRef, docId), { isPaid: !currentStatus });

ย ย ย ย }



ย ย ย ย function listenForOrders() {

ย ย ย ย ย ย if (!isAuthReady) return;

ย ย ย ย ย ย onSnapshot(query(ordersCollectionRef), (snapshot) => {

ย ย ย ย ย ย ย ย const allOrders = [];

ย ย ย ย ย ย ย ย snapshot.forEach(doc => allOrders.push({ id: doc.id, ...doc.data() }));

ย ย ย ย ย ย ย ย allOrders.sort((a, b) => a.employeeName.localeCompare(b.employeeName, 'ar'));

ย ย ย ย ย ย ย ยย

ย ย ย ย ย ย ย ย const deliveryShare = allOrders.length > 0 ? Math.round(DELIVERY_COST / allOrders.length) : 0;

ย ย ย ย ย ย ย ยย

ย ย ย ย ย ย ย ย renderAllOrders(allOrders, deliveryShare);



ย ย ย ย ย ย ย ย if (allOrders.length === 0) {

ย ย ย ย ย ย ย ย ย ย grandTotalDetailsEl.innerHTML = '';

ย ย ย ย ย ย ย ย ย ย grandTotalEl.textContent = '0 ู.ุณ';

ย ย ย ย ย ย ย ย } else {

ย ย ย ย ย ย ย ย ย ย const ordersSubtotal = allOrders.reduce((sum, order) => sum + order.total, 0);

ย ย ย ย ย ย ย ย ย ย const finalGrandTotal = ordersSubtotal + (deliveryShare * allOrders.length);

ย ย ย ย ย ย ย ย ย ย grandTotalDetailsEl.innerHTML = `

ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex justify-between"><span>ูุฌููุน ุงูุทูุจุงุช:</span> <span>${ordersSubtotal.toLocaleString()} ู.ุณ</span></div>

ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex justify-between"><span>ุชูููุฉ ุงูุชูุตูู:</span> <span>${DELIVERY_COST.toLocaleString()} ู.ุณ</span></div>

ย ย ย ย ย ย ย ย ย ย `;

ย ย ย ย ย ย ย ย ย ย grandTotalEl.textContent = `${finalGrandTotal.toLocaleString()} ู.ุณ`;

ย ย ย ย ย ย ย ย }



ย ย ย ย ย ย ย ย const itemCounts = {};

ย ย ย ย ย ย ย ย allOrders.forEach(order => {

ย ย ย ย ย ย ย ย ย ย order.items.forEach(item => {

ย ย ย ย ย ย ย ย ย ย ย ย itemCounts[item.name] = (itemCounts[item.name] || 0) + item.quantity;

ย ย ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย itemsSummaryList.innerHTML = '';ย

ย ย ย ย ย ย ย ย const sortedItems = Object.keys(itemCounts).sort((a, b) => a.localeCompare(b, 'ar'));

ย ย ย ย ย ย ย ย if (sortedItems.length === 0) {

ย ย ย ย ย ย ย ย ย ย itemsSummaryList.innerHTML = '<p class="text-gray-500 text-center py-4">ูุง ุชูุฌุฏ ุทูุจุงุช ูุญุณุงุจ ุงูููุฎุต.</p>';

ย ย ย ย ย ย ย ย } else {

ย ย ย ย ย ย ย ย ย ย const list = document.createElement('ul');

ย ย ย ย ย ย ย ย ย ย list.className = 'space-y-1';

ย ย ย ย ย ย ย ย ย ย sortedItems.forEach(itemName => {

ย ย ย ย ย ย ย ย ย ย ย ย const listItem = document.createElement('li');

ย ย ย ย ย ย ย ย ย ย ย ย listItem.className = 'flex justify-between items-center bg-gray-50 p-2 rounded-md';

ย ย ย ย ย ย ย ย ย ย ย ย listItem.innerHTML = `

ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-semibold text-gray-700">${itemName}</span>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-bold text-teal-600 text-lg">${itemCounts[itemName]}</span>

ย ย ย ย ย ย ย ย ย ย ย ย `;

ย ย ย ย ย ย ย ย ย ย ย ย list.appendChild(listItem);

ย ย ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย ย ย itemsSummaryList.appendChild(list);

ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย });

ย ย ย ย }



ย ย ย ย function init() {

ย ย ย ย ย ย employeeSelect.innerHTML = '<option value="">-- ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุงุณู --</option>';

ย ย ย ย ย ย employeeNames.sort((a, b) => a.localeCompare(b, 'ar')).forEach(name => {

ย ย ย ย ย ย ย ย const option = document.createElement('option');

ย ย ย ย ย ย ย ย option.value = name;

ย ย ย ย ย ย ย ย option.textContent = name;

ย ย ย ย ย ย ย ย employeeSelect.appendChild(option);

ย ย ย ย ย ย });

ย ย ย ย ย ย menuItemsContainer.innerHTML = '';

ย ย ย ย ย ย menuData.forEach(item => {

ย ย ย ย ย ย ย ย const card = document.createElement('div');

ย ย ย ย ย ย ย ย card.className = 'card bg-gray-50 border rounded-lg p-3 text-center';

ย ย ย ย ย ย ย ย card.innerHTML = `<h4 class="font-bold text-md">${item.name}</h4><p class="text-sm text-gray-500 mb-2">${item.price.toLocaleString()} ู.ุณ</p><div class="flex items-center justify-center gap-2"><button data-id="${item.id}" class="quantity-btn minus-btn bg-red-500 text-white w-7 h-7 rounded-full font-bold">-</button><span id="qty-${item.id}" class="text-lg font-bold w-8 text-center">0</span><button data-id="${item.id}" class="quantity-btn plus-btn bg-green-500 text-white w-7 h-7 rounded-full font-bold">+</button></div>`;

ย ย ย ย ย ย ย ย menuItemsContainer.appendChild(card);

ย ย ย ย ย ย });



ย ย ย ย ย ย employeeSelect.addEventListener('change', () => {

ย ย ย ย ย ย ย ย toggleMenuState();

ย ย ย ย ย ย ย ย currentOrder = {};

ย ย ย ย ย ย ย ย updateCurrentOrderDisplay();

ย ย ย ย ย ย ย ย submitOrderBtn.textContent = 'ุฅุถุงูุฉ ุงูุทูุจ';

ย ย ย ย ย ย });

ย ย ย ย ย ย menuItemsContainer.addEventListener('click', (e) => {

ย ย ย ย ย ย ย ย const button = e.target.closest('.quantity-btn');

ย ย ย ย ย ย ย ย if (!button) return;

ย ย ย ย ย ย ย ย const itemId = button.dataset.id;

ย ย ย ย ย ย ย ย let qty = currentOrder[itemId] || 0;

ย ย ย ย ย ย ย ย if (button.classList.contains('plus-btn')) qty++;

ย ย ย ย ย ย ย ย else qty = Math.max(0, qty - 1);

ย ย ย ย ย ย ย ย if (qty === 0) delete currentOrder[itemId];

ย ย ย ย ย ย ย ย else currentOrder[itemId] = qty;

ย ย ย ย ย ย ย ย updateCurrentOrderDisplay();

ย ย ย ย ย ย });

ย ย ย ย ย ย submitOrderBtn.addEventListener('click', handleSubmitOrder);

ย ย ย ย ย ย ordersList.addEventListener('click', (e) => {

ย ย ย ย ย ย ย ย if (e.target.closest('.edit-order-btn')) handleEditOrder(e);

ย ย ย ย ย ย ย ย if (e.target.closest('.delete-order-btn')) {ย

ย ย ย ย ย ย ย ย ย ย const btn = e.target.closest('.delete-order-btn');

ย ย ย ย ย ย ย ย ย ย if(confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุทูุจ "${btn.dataset.id}"ุ`)) {

ย ย ย ย ย ย ย ย ย ย ย ย deleteDoc(doc(ordersCollectionRef, btn.dataset.id));

ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย if (e.target.closest('.payment-status-btn')) handlePaymentStatus(e);

ย ย ย ย ย ย });

ย ย ย ย ย ย clearAllBtn.addEventListener('click', async () => {

ย ย ย ย ย ย ย ย if (!confirm("ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ูุณุญ ุฌููุน ุงูุทูุจุงุชุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.")) return;

ย ย ย ย ย ย ย ย const q = query(ordersCollectionRef);

ย ย ย ย ย ย ย ย const snapshot = await getDocs(q);

ย ย ย ย ย ย ย ย const batch = writeBatch(db);

ย ย ย ย ย ย ย ย snapshot.forEach(doc => batch.delete(doc.ref));

ย ย ย ย ย ย ย ย await batch.commit();

ย ย ย ย ย ย });

ย ย ย ย ย ยย

ย ย ย ย ย ย toggleMenuState();

ย ย ย ย ย ย setupFirebase();

ย ย ย ย }



ย ย ย ย init();

ย ย </script>

</body>

</html>
